(function(e){function t(t){for(var a,o,r=t[0],c=t[1],u=t[2],m=0,d=[];m<r.length;m++)o=r[m],Object.prototype.hasOwnProperty.call(n,o)&&n[o]&&d.push(n[o][0]),n[o]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);l&&l(t);while(d.length)d.shift()();return i.push.apply(i,u||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],a=!0,r=1;r<s.length;r++){var c=s[r];0!==n[c]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=s[0]))}return e}var a={},n={app:0},i=[];function o(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=a,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(s,a,function(t){return e[t]}.bind(null,a));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var u=0;u<r.length;u++)t(r[u]);var l=c;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},1:function(e,t){},2395:function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},i=[],o=(s("7c55"),s("2877")),r={},c=Object(o["a"])(r,n,i,!1,null,null,null),u=c.exports,l=s("8c4f"),m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"ct"},[s("header",[e._v("v1.0.0")]),e.loginStatus?e._e():s("mu-paper",{staticClass:"login_wrapper",attrs:{"z-depth":3}},[s("div",{staticClass:"login_item"},[s("span",[e._v("用户名：")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.user,expression:"user"}],staticClass:"sinput",attrs:{type:"text"},domProps:{value:e.user},on:{input:function(t){t.target.composing||(e.user=t.target.value)}}})]),s("div",{staticClass:"login_item"},[s("span",[e._v("密码:")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.pwd,expression:"pwd"}],staticClass:"sinput",attrs:{type:"password"},domProps:{value:e.pwd},on:{input:function(t){t.target.composing||(e.pwd=t.target.value)}}})]),s("div",{staticClass:"login_footer"},[s("mu-button",{attrs:{color:"primary"},on:{click:function(t){return e.register()}}},[e._v("注册")]),s("mu-button",{attrs:{color:"primary"},on:{click:function(t){return e.login()}}},[e._v("登录")])],1)]),e.loginStatus?s("mu-paper",{staticClass:"message_box",attrs:{"z-depth":4}},[s("div",{staticClass:"function_pannel"},[s("div",{staticClass:"function_pannel_ava",on:{click:function(t){return e.openUserInfoPanel()}}},[s("img",{attrs:{src:e.user_ava?e.user_ava:e.defaultAva,alt:""}})]),s("mu-tooltip",{attrs:{content:"聊天信息",placement:"right"}},[s("div",{staticClass:"function_pannel_chat",on:{click:function(t){return e.changeActiveType("chat")}}},[s("mu-icon",{directives:[{name:"show",rawName:"v-show",value:"chat"!=e.active_type,expression:"active_type!='chat'"}],attrs:{size:"40",value:"chat",color:"white"}}),s("mu-icon",{directives:[{name:"show",rawName:"v-show",value:"chat"==e.active_type,expression:"active_type=='chat'"}],attrs:{size:"40",value:"chat",color:"lightblue"}})],1)]),s("mu-tooltip",{attrs:{content:"好友列表",placement:"right"}},[s("div",{staticClass:"function_pannel_friend",on:{click:function(t){return e.changeActiveType("friend")}}},[s("mu-icon",{directives:[{name:"show",rawName:"v-show",value:"friend"!=e.active_type,expression:"active_type!='friend'"}],attrs:{size:"40",value:"contacts",color:"white"}}),s("mu-icon",{directives:[{name:"show",rawName:"v-show",value:"friend"==e.active_type,expression:"active_type=='friend'"}],attrs:{size:"40",value:"contacts",color:"lightblue"}})],1)]),s("mu-tooltip",{attrs:{content:"添加好友",placement:"right"}},[s("div",{staticClass:"function_pannel_friend",on:{click:function(t){return e.addFriend()}}},[s("mu-icon",{attrs:{size:"40",value:"add_box",color:"white"}})],1)])],1),s("div",{directives:[{name:"show",rawName:"v-show",value:"chat"==e.active_type,expression:"active_type=='chat'"}],staticClass:"function_area"},[s("div",{staticClass:"messageList"},e._l(e.messageList,(function(t,a){return s("div",{key:a,staticClass:"messageItem",on:{click:function(s){return e.focusMessageItem(t.user_name,a)}}},[s("div",{staticClass:"messageItem_leftside"},[s("img",{attrs:{src:t.ava,alt:""}}),s("span",{directives:[{name:"show",rawName:"v-show",value:0===t.is_read,expression:"item.is_read===0"}]})]),s("div",{staticClass:"messageItem_rightside"},[s("span",[e._v(e._s(t.user_name))]),s("p",[e._v(e._s(t.message))])])])})),0),s("div",{staticClass:"chat_area"},[s("div",{staticClass:"chat_area_header"},[s("span",{staticClass:"chat_area_who"},[e._v(e._s(e.active_chat))])]),s("div",{staticClass:"message_show"},e._l(e.messages,(function(t,a){return s("div",{key:a,class:t.user!=e.user?"message_item":"message_item_me"},[t.user!=e.user?s("img",{staticClass:"message_ava",attrs:{src:t.ava,alt:""},on:{click:function(s){return e.openModal(t.user)}}}):e._e(),t.user!=e.user?s("div",{staticClass:"message_item_right"},[s("p",{staticClass:"message_title_you"},[s("span",[e._v(e._s(t.user))]),s("span",{staticClass:"message_time"},[e._v(e._s(t.time))]),s("span",{staticClass:"level_label"})]),s("p",{staticClass:"message_content_you"},[s("span",{staticClass:"message_triangle_you"}),e._v(" "+e._s(t.message)+" ")])]):e._e(),t.user==e.user?s("div",{staticClass:"message_item_right_me"},[s("p",{staticClass:"message_title_me"},[s("span",[e._v(e._s(t.user))]),s("span",{staticClass:"message_time"},[e._v(e._s(t.time))]),s("span",{staticClass:"level_label"})]),s("p",{staticClass:"message_content_me"},[s("span",{staticClass:"message_triangle_me"}),e._v(" "+e._s(t.message)+" ")])]):e._e(),t.user==e.user?s("img",{staticClass:"message_ava",attrs:{src:t.ava,alt:""}}):e._e()])})),0),s("div",{staticClass:"message_send"},[s("div",{staticClass:"message_function_bar"}),s("div",{staticClass:"send_btn",on:{click:e.submitMessage}},[s("span",[e._v("发送")])]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"send_message_box",domProps:{value:e.message},on:{keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitMessage(t)},input:function(t){t.target.composing||(e.message=t.target.value)}}})])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:"friend"==e.active_type,expression:"active_type=='friend'"}],staticClass:"function_area"},[s("mu-paper",{staticClass:"function_area_friend",attrs:{"z-depth":1}},[s("mu-list",[s("mu-sub-header",[e._v("新的朋友")]),e._l(e.newFriendList,(function(t,a){return s("mu-list-item",{key:"new_friend"+a,attrs:{avatar:"",button:"",ripple:!1},on:{click:function(t){return e.handleNewFriendTask(a)}}},[s("mu-list-item-action",[s("mu-avatar",[s("img",{attrs:{src:t.from.user_ava,alt:""}})])],1),s("mu-list-item-title",[e._v(e._s(t.from.user_name))]),s("mu-list-item-action",[s("mu-icon",{attrs:{value:"chat_bubble"}})],1)],1)})),s("mu-divider"),s("mu-sub-header",[e._v("好友列表")]),e._l(e.friendList,(function(t,a){return s("mu-list-item",{key:a+"c",attrs:{avatar:"",button:"",ripple:!1},on:{click:function(t){return e.openBotttomSheet(a)}}},[s("mu-list-item-action",[s("mu-avatar",[s("img",{attrs:{src:t.user_ava,alt:""}})])],1),s("mu-list-item-title",[e._v(e._s(t.user_name))]),s("mu-list-item-action",[s("mu-icon",{attrs:{value:"chat_bubble"}})],1)],1)}))],2)],1)],1)]):e._e(),s("mu-dialog",{attrs:{title:"提示",width:"360",open:e.addFriendModal},on:{"update:open":function(t){e.addFriendModal=t}}},[e._v(" 要加此人为好友吗？ "),s("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(t){return e.sendAddFriendTask()}},slot:"actions"},[e._v("是")]),s("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(t){return e.closeSimpleDialog()}},slot:"actions"},[e._v("否")])],1),s("mu-dialog",{attrs:{title:"提示",width:"360",open:e.newFriendTaskModal},on:{"update:open":function(t){e.newFriendTaskModal=t}}},[e._v(" 接受此人的好友请求吗？ "),s("mu-button",{attrs:{slot:"actions",flat:"",color:"success"},on:{click:function(t){return e.agreeFriendRequest()}},slot:"actions"},[e._v("是")]),s("mu-button",{attrs:{slot:"actions",flat:"",color:"primary"},on:{click:function(t){e.newFriendTaskModal=!1}},slot:"actions"},[e._v("否")])],1),s("mu-dialog",{attrs:{title:"设置",width:"500",height:"600",open:e.personnalInfoModal},on:{"update:open":function(t){e.personnalInfoModal=t}}},[s("div",{staticClass:"pannel_box"},[s("div",{staticClass:"left_side"},[s("div",{class:0==e.pannel_active?"active":""},[e._v("账号设置")])]),s("div",{staticClass:"right_side"},[s("div",{staticClass:"account_setting"},[s("div",{staticClass:"ava mb10"},[s("img",{attrs:{src:e.user_ava,alt:""}}),s("mu-button",{attrs:{slot:"actions"},slot:"actions"},[e._v("上传头像")])],1),s("span",{staticClass:"mb10"},[e._v("用户账号:"+e._s(e.user))]),s("mu-button",{attrs:{slot:"actions",color:"primary"},on:{click:function(t){return e.loginOut()}},slot:"actions"},[e._v("退出登录")])],1)])])]),s("mu-container",[s("mu-bottom-sheet",{attrs:{open:e.bottomSheetOpen},on:{"update:open":function(t){e.bottomSheetOpen=t}}},[s("mu-list",{on:{"item-click":function(t){return e.closeBottomSheet()}}},[s("mu-sub-header",[e._v("Select One")]),s("mu-list-item",{attrs:{button:""},on:{click:function(t){return e.selectBottomSheet("chat")}}},[s("mu-list-item-action",[s("mu-icon",{attrs:{value:"chat",color:"green"}})],1),s("mu-list-item-title",[e._v("发消息")])],1),s("mu-list-item",{attrs:{button:""}},[s("mu-list-item-action",[s("mu-icon",{attrs:{value:"close",color:"red"}})],1),s("mu-list-item-title",[e._v("删除好友")])],1)],1)],1)],1)],1)},d=[],h=(s("4160"),s("a434"),s("159b"),s("4795"),s("8055")),_=s.n(h),f=s("a002"),v=s.n(f),p=s("e24e"),g=s.n(p),w=s("bc3a"),b=s.n(w),k="production"==Object({NODE_ENV:"production",BASE_URL:"/"})?"http://47.105.210.34:8086":"http://localhost:8086",y=function(e,t){return b.a.post(k+"/users/login",{user_name:e,user_password:t})},C=function(e,t){return b.a.post(k+"/users/register",{user_name:e,user_password:t})},L=function(e){return b.a.get(k+"/users/checkLogin?token="+e)},I=function(e,t){return b.a.get(k+"/users/friendList?user_name="+e+"&token="+t)},S=function(e){return b.a.post(k+"/users/addFriend",e)},x=_()("http://47.105.210.34:8086",{transports:["websocket","xhr-polling","jsonp-polling"],autoConnect:!1}),T={data:function(){return{token:"",loginStatus:!1,loading:!0,user:"",pwd:"",user_ava:"",defaultAva:g.a,bottomNowIndex:null,message:"",active_type:"chat",active_chat:"聊天广场",modal_active_user:null,active_new_friend:null,pannel_active:0,messages:[],stickList:[],messageList:[{user_name:"聊天广场",message:"",ava:"https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1869386756,1749725382&fm=26&gp=0.jpg",is_read:1,message_list:[]}],friendList:[],newFriendList:[],newFriendTaskModal:!1,bottomSheetOpen:!1,addFriendModal:!1,personnalInfoModal:!1,input_addFriendDialog:!1}},mounted:function(){var e=this;x.on("connect",(function(){e.$toast.success("聊天室连接正常")})),x.on("disconnect",(function(){e.$toast.error("失去连接"),e.loginStatus=!1})),this.checkIfLogin(),x.on("sayback",(function(t){var s=e.findIndexByUsername("聊天广场");"聊天广场"===e.active_chat?(e.messageList[s].is_read=1,e.messageList[s].message=t.message,e.messageList[s].message_list.push(t),e.messages.push(t)):(e.messageList[s].message_list.push(t),e.messageList[s].is_read=0)})),x.on("chatBack",(function(t){e.handleChatMessage(t)})),x.on("chatBackSelf",(function(t){var s=e.findIndexByUsername(e.active_chat);e.messages.push(t),e.messageList[s].message_list.push(t),e.srcollToBottom(),e.syncToLocal()})),x.on("self",(function(t){e.messages.push(t),e.messageList[0].message_list.push(t)})),x.on("addFriendFrom",(function(t){e.newFriendList.unshift(t),e.$toast.info("有人加您为好友")})),x.on("offLineMessages",(function(t){t.forEach((function(t){e.handleChatMessage(JSON.parse(t))})),x.emit("offLineMessagesReceived",{user:e.user})}))},beforeDestroy:function(){x.close()},methods:{initData:function(){var e=this;v.a.getItem("user_ava",(function(t,s){t&&console.error(t),e.user_ava=s})),v.a.getItem("chatHistory_"+this.user,(function(t,s){t&&console.error(t),e.messageList=s||e.messageList})),this.getFriendList()},submitMessage:function(e){e.preventDefault(),""!=this.message&&("聊天广场"==this.active_chat?x.emit("say",{message:this.message,user:this.user,user_ava:this.user_ava,type:1}):this.chat(),this.message="")},chat:function(){x.emit("chat",{message:this.message,user:this.user,user_ava:this.user_ava,to:this.active_chat,type:2})},login:function(){var e=this;y(this.user,this.pwd).then((function(t){0==t.data.errcode?(x.emit("newUser",{user:e.user}),e.user_ava=t.data.data.user_ava,e.token=t.data.data.token,v.a.setItem("token",t.data.data.token),v.a.setItem("user_ava",t.data.data.user_ava),v.a.getItem("chatHistory_"+e.user,(function(t,s){t&&console.error(t),e.messageList=s||e.messageList})),x.open(),e.loginStatus=!0,e.$toast.success("登录成功")):e.$toast.error(t.data.message)}))},register:function(){var e=this;C(this.user,this.pwd).then((function(t){0==t.data.errcode?e.$toast.success("注册成功,请登录"):e.$toast.error(t.data.message)}))},checkIfLogin:function(){var e=this;v.a.getItem("token",(function(t,s){t?e.loading=!1:(e.token=s,L(s).then((function(t){0==t.data.errcode&&(x.open(),e.user=t.data.data.user_name,e.user_ava=t.data.data.user_ava,v.a.setItem("user_ava",t.data.data.user_ava),x.emit("newUser",{user:t.data.data.user_name}),e.initData(),e.loginStatus=!0)})))}))},focusMessageItem:function(e,t){this.active_chat=e,this.message="",this.messageList[t].is_read=1;var s=JSON.stringify(this.messageList[t].message_list);this.messages=JSON.parse(s),this.srcollToBottom(),this.syncToLocal()},changeActiveType:function(e){this.active_type=e,"friend"==e&&this.getFriendList()},openModal:function(e){this.modal_active_user=e,this.addFriendModal=!0},closeSimpleDialog:function(){this.modal_active_user=null,this.addFriendModal=!1},openUserInfoPanel:function(){this.personnalInfoModal=!0},closeUserInfoPanel:function(){this.personnalInfoModal=!1},sendAddFriendTask:function(){this.checkIfFriend(this.modal_active_user)&&x.emit("addFriendTo",{from:{user_name:this.user,user_ava:this.user_ava},to:this.modal_active_user})},getFriendList:function(){var e=this;v.a.getItem("token").then((function(t){return I(e.user,t)})).then((function(t){0==t.data.errcode&&(e.friendList=t.data.data.user_friends)}))},closeBottomSheet:function(e){this.bottomSheetOpen=!1},openBotttomSheet:function(e){this.bottomNowIndex=e,this.bottomSheetOpen=!0},selectBottomSheet:function(e){switch(e){case"chat":this.active_type="chat",this.message="";for(var t=0;t<this.messageList.length;t++)if(this.messageList[t].user_name==this.friendList[this.bottomNowIndex].user_name)return void this.focusMessageItem(this.messageList[t].user_name,t);this.messageList.push({user_name:this.friendList[this.bottomNowIndex].user_name,message:"",ava:this.friendList[this.bottomNowIndex].user_ava,is_read:1,message_list:[]}),this.focusMessageItem(this.messageList[this.messageList.length-1].user_name,this.messageList.length-1);break;case"delete":break}},findIndexByUsername:function(e){for(var t=this.messageList.length,s=0;s<t;s++)if(this.messageList[s].user_name==e)return s;return-1},syncToLocal:function(){v.a.setItem("chatHistory_"+this.user,this.messageList)},handleChatMessage:function(e){var t=this.findIndexByUsername(e.user);-1==t?this.messageList.push({user_name:e.user,message:e.message,ava:e.ava,is_read:0,message_list:[e]}):(this.messageList[t].message=e.message,this.messageList[t].message_list.push(e),this.messageList[t].is_read=0,this.active_chat==e.user&&(this.messages.push(e),this.messageList[t].is_read=1)),this.srcollToBottom(),this.syncToLocal()},srcollToBottom:function(){setTimeout((function(){var e=document.getElementsByClassName("message_show")[0];e.scrollTop=e.scrollHeight}),100)},addFriend:function(){var e=this;this.$prompt("请输入要添加的账号","提示").then((function(t){var s=t.result,a=t.value;s?e.checkIfFriend(a)&&(x.emit("addFriendTo",{from:{user_name:e.user,user_ava:e.user_ava},to:a}),e.$toast.success("请求已发送")):e.$toast.message("取消操作")}))},loginOut:function(){var e=this;v.a.removeItem("token").then((function(t){e.$toast.success("退出登录"),e.loginStatus=!1,e.personnalInfoModal=!1}))},handleNewFriendTask:function(e){this.active_new_friend=e,this.newFriendTaskModal=!0},agreeFriendRequest:function(){var e=this;S({token:this.newFriendList[this.active_new_friend].token}).then((function(t){0==t.data.errcode?(e.newFriendList.splice(e.active_new_friend,1),e.active_new_friend=null,e.newFriendTaskModal=!1,e.$toast.success("好友添加成功")):e.$toast.error("好友添加失败")}))},checkIfFriend:function(e){for(var t=this.friendList.length,s=0;s<t;s++)if(this.friendList[s].user_name==e)return this.$toast.error("你们已经是好友了"),!1;return!0}}},A=T,F=(s("faff"),Object(o["a"])(A,m,d,!1,null,"26a6f584",null)),M=F.exports;a["a"].use(l["a"]);var N=[{path:"/",name:"home",component:M}],O=new l["a"]({mode:"history",base:"/",routes:N}),B=O,P=s("30f4"),E=(s("d6f6"),s("aa12"),s("2095"),s("dd88")),j=s("4d7d");a["a"].use(j["a"]),a["a"].use(P["a"]),a["a"].use(E["a"],{position:"top-end",time:2e3,closeIcon:"close",close:!0,successIcon:"check_circle",infoIcon:"info",warningIcon:"priority_high",errorIcon:"warning"}),a["a"].config.productionTip=!1,new a["a"]({router:B,render:function(e){return e(u)}}).$mount("#app")},"7c55":function(e,t,s){"use strict";var a=s("2395"),n=s.n(a);n.a},e24e:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEcAAABHBAMAAACnnkcsAAAAKlBMVEXp6en////9/f3n5+ft7e3k5OTi4uLo6Oj09PT5+fnx8fHv7+/7+/v29vYwAPVJAAACIklEQVRIx83Vz2sTQRTAcWXYzcWD7xGwTRvwPQvqbVF3C54SqJ4Hm6VGKCzEWH8dApro0Qip4G0PuRsPBW/N3asH8eof5Jh1szPZmS0WWvqS3D58d3gsk0snj2idLzq+gGc6SxTGcXDCCkT8dqcl+oOqkuh9I4DbX8Jn8Z4T7X6Fxfz8vNMaOJB/BZZzLbCj2lMo5sjxOH9emEbiQB0tVE/sKxCPQBvPXvLHOpra0TboU5dW9NJATSuqdQ2Eb2xIXAZjHtiQ1zbRxLYCb2aiw6J0HmhyajSam+goKCPRSU30624ZeWNYmemgtKd3tIrqMi/9H/JSQAZGQlKc1e9mUEJ+mxmZGNWHmdR3Uj54rYtIC0NqGBGEZU8SzFIjsSB/rJeIfgSWV0V0US9haH3Hw1QvXZdW5N3RSvDQcT89h6K07rp6tqEo1aUD+bNliaYDx+PEa8xLMHReh3uQlzYSJ/LbmJXosOJifYULhc2DChRAVtpIKtA9yEoNWYE6/0oacp9pLXH/bYgXmJVw6C5FY85KNJUu5O3nG8fNyIFEkmYGkWmrb0WiN0POSwif+hY0PPgOtCwxwYc4WEWh/AjMRQkJfkeBiaL7KTDpJdW65Ukdjd6TMmaJGZp+UCDvCSHTaokY1qIlqiUpEpVLSm31chTNkdhWUmoiM+TtA7G9RLQ5ylCcMrtKTFcTcby4A7hicPi3FKZcNXRjV6HHyJWzHrb+APDSrmor0CXDAAAAAElFTkSuQmCC"},faff:function(e,t,s){"use strict";var a=s("ffef"),n=s.n(a);n.a},ffef:function(e,t,s){}});
//# sourceMappingURL=app.451e0865.js.map